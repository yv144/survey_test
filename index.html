<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitBot - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –æ–ø—Ä–æ—Å</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 6px;
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 3px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.5);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            transform: translateY(20px);
            opacity: 0;
            animation: slideIn 0.5s forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .step-indicator {
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
            font-weight: 700;
        }

        .subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            color: #555;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option,
        .checkbox-option {
            display: flex;
            align-items: center;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .radio-option:hover,
        .checkbox-option:hover {
            border-color: #667eea;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .radio-option input,
        .checkbox-option input {
            margin-right: 12px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
        }

        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .radio-option.selected,
        .checkbox-option.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
            margin-right: 10px;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .insight-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.6;
            animation: pulse 2s infinite;
            box-shadow: 0 10px 30px rgba(245, 87, 108, 0.3);
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
        }

        .emoji {
            font-size: 24px;
            margin-right: 8px;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .success-animation {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: successPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes successPop {
            0% {
                transform: scale(0);
            }
            100% {
                transform: scale(1);
            }
        }

        .success-animation::after {
            content: "‚úì";
            color: white;
            font-size: 40px;
            font-weight: bold;
        }

        /* Mobile optimizations */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            h2 {
                font-size: 20px;
            }
            
            .subtitle {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="step-indicator" id="stepIndicator">–®–∞–≥ 1 –∏–∑ 8</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 12.5%"></div>
        </div>

        <div class="card">
            <!-- Step 1: Goal -->
            <div class="step" id="step1">
                <h2><span class="emoji">üéØ</span>–ö–∞–∫–∞—è —Ç–≤–æ—è —Ü–µ–ª—å?</h2>
                <p class="subtitle">–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –º–Ω–µ —Å–æ–∑–¥–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∏–º–µ–Ω–Ω–æ –¥–ª—è —Ç–µ–±—è</p>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="goal" value="lose_weight">
                        <span>üî• –ü–æ—Ö—É–¥–µ—Ç—å</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="goal" value="gain_muscle">
                        <span>üí™ –ù–∞–±—Ä–∞—Ç—å –º—ã—à–µ—á–Ω—É—é –º–∞—Å—Å—É</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="goal" value="maintain">
                        <span>‚öñÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –≤–µ—Å</span>
                    </label>
                </div>
            </div>

            <!-- Step 2: Basic Info -->
            <div class="step hidden" id="step2">
                <h2><span class="emoji">üìä</span>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <p class="subtitle">–ù—É–∂–Ω–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–∞–ª–æ—Ä–∏–π –∏ –ë–ñ–£</p>
                <div class="form-group">
                    <label>–í–æ–∑—Ä–∞—Å—Ç</label>
                    <input type="number" id="age" min="10" max="100" placeholder="25">
                </div>
                <div class="form-group">
                    <label>–ü–æ–ª</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="gender" value="male">
                            <span>üë® –ú—É–∂—Å–∫–æ–π</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="female">
                            <span>üë© –ñ–µ–Ω—Å–∫–∏–π</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="prefer_not_to_say">
                            <span>ü§ê –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç—å</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Step 3: Physical Parameters -->
            <div class="step hidden" id="step3">
                <h2><span class="emoji">üìè</span>–§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
                <p class="subtitle">–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ç–≤–æ–µ–π –Ω–æ—Ä–º—ã</p>
                <div class="form-group">
                    <label>–†–æ—Å—Ç (—Å–º)</label>
                    <input type="number" id="height" min="100" max="250" placeholder="175">
                </div>
                <div class="form-group">
                    <label>–í–µ—Å (–∫–≥)</label>
                    <input type="number" id="weight" min="30" max="300" step="0.1" placeholder="70">
                </div>
            </div>

            <!-- Step 4: Activity Level -->
            <div class="step hidden" id="step4">
                <h2><span class="emoji">üèÉ</span>–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
                <p class="subtitle">–°–∫–æ–ª—å–∫–æ —Ç—ã –¥–≤–∏–≥–∞–µ—à—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è?</p>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="activity" value="sedentary">
                        <span>ü™ë –°–∏–¥—è—á–∏–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="activity" value="light">
                        <span>üö∂ –õ–µ–≥–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (1-3 –¥–Ω—è –≤ –Ω–µ–¥–µ–ª—é)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="activity" value="moderate">
                        <span>üèÉ‚Äç‚ôÄÔ∏è –£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (3-5 –¥–Ω–µ–π)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="activity" value="active">
                        <span>üèãÔ∏è –í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (6-7 –¥–Ω–µ–π)</span>
                    </label>
                </div>
            </div>

            <!-- Step 5: Target Weight -->
            <div class="step hidden" id="step5">
                <h2><span class="emoji">üéØ</span>–¶–µ–ª–µ–≤–æ–π –≤–µ—Å</h2>
                <p class="subtitle">–ö –∫–∞–∫–æ–º—É –≤–µ—Å—É —Ç—ã —Å—Ç—Ä–µ–º–∏—à—å—Å—è?</p>
                <div class="form-group">
                    <label>–ñ–µ–ª–∞–µ–º—ã–π –≤–µ—Å (–∫–≥)</label>
                    <input type="number" id="targetWeight" min="30" max="300" step="0.1" placeholder="65">
                </div>
                <div class="form-group">
                    <label>–ó–∞ –∫–∞–∫–æ–π —Å—Ä–æ–∫ —Ö–æ—á–µ—à—å –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–∏?</label>
                    <select id="timeline">
                        <option value="1">1 –º–µ—Å—è—Ü</option>
                        <option value="2">2 –º–µ—Å—è—Ü–∞</option>
                        <option value="3" selected>3 –º–µ—Å—è—Ü–∞</option>
                        <option value="6">6 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="12">1 –≥–æ–¥</option>
                    </select>
                </div>
                <div class="insight-box hidden" id="timelineInsight"></div>
            </div>

            <!-- Step 6: Food Restrictions -->
            <div class="step hidden" id="step6">
                <h2><span class="emoji">üö´</span>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ –ø–∏—Ç–∞–Ω–∏–∏</h2>
                <p class="subtitle">–ß—Ç–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ —Ç–≤–æ–µ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞?</p>
                <div class="checkbox-group">
                    <label class="checkbox-option">
                        <input type="checkbox" name="restrictions" value="meat">
                        <span>ü•© –ú—è—Å–æ</span>
                    </label>
					<label class="checkbox-option">
						<input type="checkbox" name="restrictions" value="pork">
						<span>üê∑ –°–≤–∏–Ω–∏–Ω–∞</span>
					</label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="restrictions" value="fish">
                        <span>üêü –†—ã–±–∞</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="restrictions" value="dairy">
                        <span>ü•õ –ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="restrictions" value="eggs">
                        <span>ü•ö –Ø–π—Ü–∞</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="restrictions" value="gluten">
                        <span>üåæ –ì–ª—é—Ç–µ–Ω</span>
                    </label>
					<label class="checkbox-option">
						<input type="checkbox" name="restrictions" value="flour_products">
						<span>üçû –ú—É—á–Ω–æ–µ</span>
					</label>		
                    <label class="checkbox-option">
                        <input type="checkbox" name="restrictions" value="nuts">
                        <span>ü•ú –û—Ä–µ—Ö–∏</span>
                    </label>
					<label class="checkbox-option">
						<input type="checkbox" name="restrictions" value="citrus">
						<span>üçä –¶–∏—Ç—Ä—É—Å–æ–≤—ã–µ</span>
					</label>
                </div>
				
								<!-- Add this new section for freeform input -->
				<div class="form-group" style="margin-top: 25px;">
					<label>–î—Ä—É–≥–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –Ω–µ –ª—é–±–∏—à—å –∏–ª–∏ –Ω–µ –º–æ–∂–µ—à—å –µ—Å—Ç—å:</label>
					<input type="text" id="additionalRestrictions" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≥—Ä–∏–±—ã, –±–∞–∫–ª–∞–∂–∞–Ω—ã, –æ—Å—Ç—Ä–æ–µ">
					<small style="color: #666; margin-top: 5px; display: block;">–ü–µ—Ä–µ—á–∏—Å–ª–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</small>
				</div>
				
            </div>

            <!-- Step 7: Preferred Foods -->
            <div class="step hidden" id="step7">
                <h2><span class="emoji">üòã</span>–õ—é–±–∏–º—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h2>
                <p class="subtitle">–ß—Ç–æ —Ç—ã –ª—é–±–∏—à—å –µ—Å—Ç—å? –Ø –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –≤–∫–ª—é—á–∏—Ç—å —ç—Ç–æ –≤ –ø–ª–∞–Ω</p>
                <div class="form-group">
                    <input type="text" id="preferredFoods" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫—É—Ä–∏—Ü–∞, –≥—Ä–µ—á–∫–∞, —è–±–ª–æ–∫–∏">
                    <small style="color: #666; margin-top: 5px; display: block;">–ü–µ—Ä–µ—á–∏—Å–ª–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</small>
                </div>
            </div>

            <!-- Step 8: Summary -->
            <div class="step hidden" id="step8">
                <h2><span class="emoji">‚úÖ</span>–ü—Ä–æ–≤–µ—Ä—å –¥–∞–Ω–Ω—ã–µ</h2>
                <p class="subtitle">–í—Å—ë –≤–µ—Ä–Ω–æ?</p>
                <div id="summary" style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;"></div>
            </div>

            <!-- Success -->
            <div class="step hidden" id="success">
                <div class="success-animation"></div>
                <h2 style="text-align: center;">–û—Ç–ª–∏—á–Ω–æ! üéâ</h2>
                <p class="subtitle" style="text-align: center;">–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã. –í–æ–∑–≤—Ä–∞—â–∞–π—Å—è –≤ –±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è!</p>
            </div>

            <!-- Navigation -->
            <div class="navigation" id="navigation">
                <button class="btn btn-secondary hidden" id="prevBtn" onclick="previousStep()">–ù–∞–∑–∞–¥</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">–î–∞–ª–µ–µ</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // Current step
        let currentStep = 1;
        const totalSteps = 8;

        // User data
        let userData = {
            user_id: new URLSearchParams(window.location.search).get('user_id') || 0
        };

        // Update radio/checkbox visual state
        document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
            input.addEventListener('change', function() {
                if (this.type === 'radio') {
                    document.querySelectorAll(`input[name="${this.name}"]`).forEach(radio => {
                        radio.closest('.radio-option').classList.remove('selected');
                    });
                }
                this.closest('.radio-option, .checkbox-option')?.classList.toggle('selected', this.checked);
            });
        });

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('stepIndicator').textContent = `–®–∞–≥ ${currentStep} –∏–∑ ${totalSteps}`;
        }

        function validateStep() {
            switch(currentStep) {
                case 1:
                    return document.querySelector('input[name="goal"]:checked');
                case 2:
                    return document.getElementById('age').value && 
                           document.querySelector('input[name="gender"]:checked');
                case 3:
                    return document.getElementById('height').value && 
                           document.getElementById('weight').value;
                case 4:
                    return document.querySelector('input[name="activity"]:checked');
                case 5:
                    return document.getElementById('targetWeight').value;
                case 6:
                case 7:
                    return true; // Optional steps
                case 8:
                    return true;
                default:
                    return false;
            }
        }

        function showInsight() {
            if (currentStep === 5) {
                const currentWeight = parseFloat(userData.weight);
                const targetWeight = parseFloat(document.getElementById('targetWeight').value);
                const timeline = parseInt(document.getElementById('timeline').value);
                
                if (currentWeight && targetWeight && timeline) {
                    const weightDiff = Math.abs(currentWeight - targetWeight);
                    const weeklyChange = (weightDiff / (timeline * 4)).toFixed(1);
                    const isLoss = currentWeight > targetWeight;
                    
                    let insight = '';
                    if (weeklyChange > 1) {
                        insight = `‚ö†Ô∏è –≠—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ –∞–º–±–∏—Ü–∏–æ–∑–Ω–∞—è —Ü–µ–ª—å! –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ${isLoss ? '—Ç–µ—Ä—è—Ç—å' : '–Ω–∞–±–∏—Ä–∞—Ç—å'} –Ω–µ –±–æ–ª–µ–µ 0.5-1 –∫–≥ –≤ –Ω–µ–¥–µ–ª—é –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è.`;
                    } else {
                        insight = `‚úÖ –û—Ç–ª–∏—á–Ω–∞—è —Ü–µ–ª—å! ${isLoss ? '–ü–æ—Ç–µ—Ä—è' : '–ù–∞–±–æ—Ä'} ${weeklyChange} –∫–≥ –≤ –Ω–µ–¥–µ–ª—é - —ç—Ç–æ –∑–¥–æ—Ä–æ–≤—ã–π —Ç–µ–º–ø.`;
                    }
                    
                    const insightBox = document.getElementById('timelineInsight');
                    insightBox.textContent = insight;
                    insightBox.classList.remove('hidden');
                }
            }
        }

        function collectData() {
            // Goal
            userData.goal = document.querySelector('input[name="goal"]:checked')?.value;
            
            // Basic info
            userData.age = parseInt(document.getElementById('age').value);
            userData.gender = document.querySelector('input[name="gender"]:checked')?.value;
            
            // Physical
            userData.height = parseInt(document.getElementById('height').value);
            userData.weight = parseFloat(document.getElementById('weight').value);
            
            // Activity
            userData.activity_level = document.querySelector('input[name="activity"]:checked')?.value;
            
            // Target
            userData.target_weight = parseFloat(document.getElementById('targetWeight').value);
            userData.timeline_months = parseInt(document.getElementById('timeline').value);
            
            // Restrictions
			const checkboxRestrictions = Array.from(document.querySelectorAll('input[name="restrictions"]:checked'))
				.map(cb => cb.value);
				
			const additionalText = document.getElementById('additionalRestrictions').value;
			
			const additionalRestrictions = additionalText 
				? additionalText.split(',').map(f => f.trim()).filter(f => f)
				: [];
			
			userData.foods_to_avoid = [...checkboxRestrictions, ...additionalRestrictions];
            
            // Preferences
            const preferred = document.getElementById('preferredFoods').value;
            userData.preferred_foods = preferred ? preferred.split(',').map(f => f.trim()).filter(f => f) : [];
        }

        function showSummary() {
            collectData();
            
            const goalText = {
                'lose_weight': '–ü–æ—Ö—É–¥–µ—Ç—å',
                'gain_muscle': '–ù–∞–±—Ä–∞—Ç—å –º—ã—à–µ—á–Ω—É—é –º–∞—Å—Å—É',
                'maintain': '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤–µ—Å'
            };
            
            const genderText = {
                'male': '–ú—É–∂—Å–∫–æ–π',
                'female': '–ñ–µ–Ω—Å–∫–∏–π',
                'prefer_not_to_say': '–ù–µ —É–∫–∞–∑–∞–Ω'
            };
            
            const summary = `
                <p><strong>–¶–µ–ª—å:</strong> ${goalText[userData.goal]}</p>
                <p><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> ${userData.age} –ª–µ—Ç</p>
                <p><strong>–ü–æ–ª:</strong> ${genderText[userData.gender]}</p>
                <p><strong>–†–æ—Å—Ç:</strong> ${userData.height} —Å–º</p>
                <p><strong>–¢–µ–∫—É—â–∏–π –≤–µ—Å:</strong> ${userData.weight} –∫–≥</p>
                <p><strong>–¶–µ–ª–µ–≤–æ–π –≤–µ—Å:</strong> ${userData.target_weight} –∫–≥</p>
                <p><strong>–°—Ä–æ–∫:</strong> ${userData.timeline_months} –º–µ—Å.</p>
				${userData.foods_to_avoid.length > 0 ? 
					`<p><strong>–ò—Å–∫–ª—é—á–∏—Ç—å:</strong><br>${userData.foods_to_avoid.map(item => 
						`‚Ä¢ ${item}`).join('<br>')}</p>` : ''}
                ${userData.preferred_foods.length > 0 ? `<p><strong>–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è:</strong> ${userData.preferred_foods.join(', ')}</p>` : ''}
            `;
            
            document.getElementById('summary').innerHTML = summary;
        }

        function nextStep() {
            if (currentStep === 8) {
                submitData();
                return;
            }
            
            if (!validateStep()) {
                tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            document.getElementById(`step${currentStep}`).classList.add('hidden');
            currentStep++;
            document.getElementById(`step${currentStep}`).classList.remove('hidden');
            
            updateProgress();
            updateButtons();
            
            if (currentStep === 5) {
                showInsight();
            } else if (currentStep === 8) {
                showSummary();
            }
        }

        function previousStep() {
            document.getElementById(`step${currentStep}`).classList.add('hidden');
            currentStep--;
            document.getElementById(`step${currentStep}`).classList.remove('hidden');
            
            updateProgress();
            updateButtons();
        }

        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.classList.toggle('hidden', currentStep === 1);
            nextBtn.textContent = currentStep === 8 ? '–û—Ç–ø—Ä–∞–≤–∏—Ç—å' : '–î–∞–ª–µ–µ';
        }

        function submitData() {
            collectData();
            
            // Show loading
            document.getElementById('step8').classList.add('hidden');
            document.getElementById('navigation').classList.add('hidden');
            
            // Send data to Telegram
            tg.sendData(JSON.stringify(userData));
            
            // Show success
            setTimeout(() => {
                document.getElementById('success').classList.remove('hidden');
                
                // Close after 2 seconds
                setTimeout(() => {
                    tg.close();
                }, 2000);
            }, 500);
        }

        // Event listeners for dynamic validation
        document.getElementById('targetWeight').addEventListener('input', showInsight);
        document.getElementById('timeline').addEventListener('change', showInsight);
    </script>
</body>
</html>
</html>
